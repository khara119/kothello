<!DOCTYPE html><html><head><link rel="stylesheet" href="css/main.css"><!--include js/main.js--><title>Kothello</title></head><body><script>let board = [];
let put_area = [];
let table = [];
let turn = 1;
window.onload = () => {
	const tbody = document.getElementsByTagName('tbody')[0];
	for (let i=0; i<8; i++) {
		const tr = tbody.getElementsByTagName('tr')[i];
		table[i] = [];
		board[i] = [];
		put_area[i] = [];
		for (let j=0; j<8; j++) {
			const color = Math.floor(Math.random() * 3 - 1);
			const stone = tr.getElementsByClassName('stone')[j];
			table[i][j] = stone;
			put_area[i][j] = 0;
			if (color == 1) {
				table[i][j].classList.add('black');
				board[i][j] = 1;
			} else if (color == -1) { 
				table[i][j].classList.add('white');
				board[i][j] = -1;
			}
		}
	}
};

const start = () => {
	board = [];
	turn = 1;
	for (let i=0; i<8; i++) {
		board[i] = [];
		put_area[i] = [];
		for (let j=0; j<8; j++) {
			board[i][j] = 0;
			put_area[i][j] = 0;
			table[i][j].classList.remove('black');
			table[i][j].classList.remove('white');
		}
	}
	board[3][3] = -1;
	board[3][4] = 1;
	board[4][3] = 1;
	board[4][4] = -1;

	table[3][3].classList.add('white');
	table[3][4].classList.add('black');
	table[4][3].classList.add('black');
	table[4][4].classList.add('white');

	updatePutArea();
};

const updatePutArea = () => {
	const other = turn*(-1);
	for (let i=0; i<8; i++) {
		for (let j=0; j<8; j++) {
			put_area[i][j] = 0;
			table[i][j].parentElement.classList.remove('put');

			// 上方向の確認
			if (i >= 2 && board[i-1][j]==other) {
				if (check(i-2, -1, j, 0)) {
					put_area[i][j] = 1;
				}
			}

			// 右上方向の確認
			if (i >= 2 && j < 6 &&
				board[i-1][j+1] == other) {
				if (check(i-2, -1, j+2, 1)) {
					put_area[i][j] = 1;
				}
			}

			// 右方向の確認
			if (j < 6 && board[i][j+1]==other) {
				if (check(i, 0, j+2, 1)) {
					put_area[i][j] = 1;
				}
			}

			// 右下方向の確認
			if (i < 6 && j < 6 &&
				board[i+1][j+1] == other) {
				if (check(i+2, 1, j+2, 1)) {
					put_area[i][j] = 1;
				}
			}

			// 下方向の確認
			if (i < 6 && board[i+1][j]==other) {
				if (check(i+1, 1, j, 0)) {
					put_area[i][j] = 1;
				}
			}

			// 左下方向の確認
			if (i < 6 && j >= 2 &&
				board[i+1][j-1] == other) {
				if (check(i+2, 1, j-2, -1)) {
					put_area[i][j] = 1;
				}
			}

			// 左方向の確認
			if (j >= 2 && board[i][j-1]==other) {
				if (check(i, 0, j-2, -1)) {
					put_area[i][j] = 1;
				}
			}

			// 左上方向の確認
			if (i >= 2 && j >= 2 &&
				board[i-1][j-1] == other) {
				if (check(i-2, -1, j-2, -1)) {
					put_area[i][j] = 1;
				}
			}

			if (put_area[i][j]) {
				console.log(table[i][j].parentElement);
				table[i][j].parentElement.classList.add('put');
			}
		}
	}
};

const check = (i, i_dir, j, j_dir) => {
	if (i < 0 || i >= 8 ||
		j < 0 || j >= 8 ||
		board[i][j] == 0) {
		return false;
	}

	if (board[i][j] == turn) {
		return true;
	}

	return check(i+i_dir, i_dir, j+j_dir, j_dir);
};

const putStone = (i, j) => {
	// おけない箇所であれば何もしない
	if (!turnUp(i, j)) {
		return;
	}

	turn *= -1;
	updatePutArea();
	console.log(board);
	console.log('next => '+turn);
};

const updateStone = (turn, i, j) => {
	if (i == undefined || j == undefined) {
		for (i=0; i<8; i++) {
			for (j=0; j<8; j++) {
				table[i][j].classList.remove('black');
				table[i][j].classList.remove('white');
				if (board[i][j] == 1) {
					table[i][j].classList.add('black');
				} else if(board[i][j] == -1) {
					table[i][j].classList.add('white');
				}
			}
		}
	} else {
		table[i][j].classList.remove('black');
		table[i][j].classList.remove('white');
		if (board[i][j] == 1) {
			table[i][j].classList.add('black');
		} else if(board[i][j] == -1) {
			table[i][j].classList.add('white');
		}
	}
};
</script><div class="main"><div class="status"><div class="left"></div><div class="center"><div onclick="start()" class="button">開始</div><div onclick="retire()" class="button">降参</div></div><div class="right"></div></div><table id="board"><tr><td onclick="putStone(0, 0)"><div class="stone"></div></td><td onclick="putStone(0, 1)"><div class="stone"></div></td><td onclick="putStone(0, 2)"><div class="stone"></div></td><td onclick="putStone(0, 3)"><div class="stone"></div></td><td onclick="putStone(0, 4)"><div class="stone"></div></td><td onclick="putStone(0, 5)"><div class="stone"></div></td><td onclick="putStone(0, 6)"><div class="stone"></div></td><td onclick="putStone(0, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(1, 0)"><div class="stone"></div></td><td onclick="putStone(1, 1)"><div class="stone"></div></td><td onclick="putStone(1, 2)"><div class="stone"></div></td><td onclick="putStone(1, 3)"><div class="stone"></div></td><td onclick="putStone(1, 4)"><div class="stone"></div></td><td onclick="putStone(1, 5)"><div class="stone"></div></td><td onclick="putStone(1, 6)"><div class="stone"></div></td><td onclick="putStone(1, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(2, 0)"><div class="stone"></div></td><td onclick="putStone(2, 1)"><div class="stone"></div></td><td onclick="putStone(2, 2)"><div class="stone"></div></td><td onclick="putStone(2, 3)"><div class="stone"></div></td><td onclick="putStone(2, 4)"><div class="stone"></div></td><td onclick="putStone(2, 5)"><div class="stone"></div></td><td onclick="putStone(2, 6)"><div class="stone"></div></td><td onclick="putStone(2, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(3, 0)"><div class="stone"></div></td><td onclick="putStone(3, 1)"><div class="stone"></div></td><td onclick="putStone(3, 2)"><div class="stone"></div></td><td onclick="putStone(3, 3)"><div class="stone"></div></td><td onclick="putStone(3, 4)"><div class="stone"></div></td><td onclick="putStone(3, 5)"><div class="stone"></div></td><td onclick="putStone(3, 6)"><div class="stone"></div></td><td onclick="putStone(3, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(4, 0)"><div class="stone"></div></td><td onclick="putStone(4, 1)"><div class="stone"></div></td><td onclick="putStone(4, 2)"><div class="stone"></div></td><td onclick="putStone(4, 3)"><div class="stone"></div></td><td onclick="putStone(4, 4)"><div class="stone"></div></td><td onclick="putStone(4, 5)"><div class="stone"></div></td><td onclick="putStone(4, 6)"><div class="stone"></div></td><td onclick="putStone(4, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(5, 0)"><div class="stone"></div></td><td onclick="putStone(5, 1)"><div class="stone"></div></td><td onclick="putStone(5, 2)"><div class="stone"></div></td><td onclick="putStone(5, 3)"><div class="stone"></div></td><td onclick="putStone(5, 4)"><div class="stone"></div></td><td onclick="putStone(5, 5)"><div class="stone"></div></td><td onclick="putStone(5, 6)"><div class="stone"></div></td><td onclick="putStone(5, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(6, 0)"><div class="stone"></div></td><td onclick="putStone(6, 1)"><div class="stone"></div></td><td onclick="putStone(6, 2)"><div class="stone"></div></td><td onclick="putStone(6, 3)"><div class="stone"></div></td><td onclick="putStone(6, 4)"><div class="stone"></div></td><td onclick="putStone(6, 5)"><div class="stone"></div></td><td onclick="putStone(6, 6)"><div class="stone"></div></td><td onclick="putStone(6, 7)"><div class="stone"></div></td></tr><tr><td onclick="putStone(7, 0)"><div class="stone"></div></td><td onclick="putStone(7, 1)"><div class="stone"></div></td><td onclick="putStone(7, 2)"><div class="stone"></div></td><td onclick="putStone(7, 3)"><div class="stone"></div></td><td onclick="putStone(7, 4)"><div class="stone"></div></td><td onclick="putStone(7, 5)"><div class="stone"></div></td><td onclick="putStone(7, 6)"><div class="stone"></div></td><td onclick="putStone(7, 7)"><div class="stone"></div></td></tr></table></div></body></html>